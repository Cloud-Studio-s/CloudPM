# v1.1.0 – Changelog

> API-focused release: **quality-of-life improvements** for plugin developers.  
> No existing methods were removed; all changes are additive and backwards-compatible.

---

## Highlights

- Added a new **chunk queue event**: `PlayerChunkQueuedSendEvent`.
- Exposed more **chunk / spawn / ping** information on `Player`.
- Extended multiple core events with **helper methods**:
  - `PlayerMoveEvent`, `PlayerChatEvent`
  - `EntityDamageEvent`, `EntityDamageByEntityEvent`
  - `PlayerInteractEvent`
  - `PlayerDeathEvent`, `PlayerRespawnEvent`
  - `BlockBreakEvent`, `BlockPlaceEvent`
- Server behavior is unchanged unless plugins use the new APIs.

---

## Added

### Player & Chunk API

#### New event: `PlayerChunkQueuedSendEvent`

**Namespace:** `pocketmine\event\player\PlayerChunkQueuedSendEvent`  

Fired whenever a chunk is **queued** to be sent to a player (before it is actually sent).

- Constructor:
  - `__construct(Player $player, int $chunkX, int $chunkZ, int $priority)`
- Methods:
  - `getChunkX() : int`
  - `getChunkZ() : int`
  - `getPriority() : int`
  - `setPriority(int $priority) : void`
- Implements `Cancellable`.

**Example usage (concept):**

Increase priority for chunks near spawn, or cancel queuing for unwanted regions.

> If the event is cancelled, the chunk is **not** queued for that request.

---

#### `Player::getChunkQueueSize() : int`

Returns how many chunks are currently queued to be sent to this player.

**Example usage:** show a debug message with number of pending chunks.

---

#### `Player::getPendingChunkSends() : array`

Returns a list of queued chunks, each entry like:

- `["chunkX" => int, "chunkZ" => int, "priority" => int]`

**Example usage:** log or display every queued chunk with its priority for debugging.

---

#### `Player::getUsedChunkCount() : int`

Returns how many chunks this player is currently using.

**Example usage:** show how many chunks around the player are active/used.

---

#### `Player::getSpawnChunkLoadProgress() : float`

Spawn terrain load progress:

- `0.0 .. 1.0` while loading.
- `-1.0` if not loading or already completed.

**Example usage:** display a simple “Loading terrain: X%” progress bar in a tip.

---

#### `Player::getPing() : ?int`

Returns the player’s ping in milliseconds, or `null` if not yet known.

**Example usage:** display ping in a scoreboard, chat or debug command.

---

#### `Player::isTerrainReady() : bool`

Returns `true` once the initial terrain is considered ready for this player.

**Example usage:** block commands or actions until terrain is ready, to avoid weird behavior while chunks are still loading.

---

### Event Helper Improvements

All classes below gained **only new methods**; no existing signatures were changed.

---

## Improved: `PlayerMoveEvent`

**Namespace:** `pocketmine\event\player\PlayerMoveEvent`

New methods:

- Position deltas:
  - `getDeltaX() : float`
  - `getDeltaY() : float`
  - `getDeltaZ() : float`
- Distance:
  - `getDistanceSquared() : float`
  - `getHorizontalDistanceSquared() : float`
- Rotation:
  - `getDeltaYaw() : float`
  - `getDeltaPitch() : float`
- Flags:
  - `hasPositionChanged() : bool`
  - `hasRotationChanged() : bool`
  - `isRotationOnly() : bool`

**Examples (conceptual):**

- Ignore micro-movements: use `getHorizontalDistanceSquared()` And `hasRotationChanged()` to filter very small jitter.
- Recognizing rotation-only motion: Use `isRotationOnly()` for gaze-direction-only triggers.

---

## Improved: `PlayerChatEvent`

**Namespace:** `pocketmine\event\player\PlayerChatEvent`

New methods (recipient management):

- `getRecipientCount() : int`
- `addRecipient(CommandSender $recipient) : void`
- `removeRecipient(CommandSender $recipient) : void`
- `clearRecipients() : void`
- `isRecipient(CommandSender $recipient) : bool`

**Examples:**

- Create staff-only chats:
  - use `clearRecipients()` and `addRecipient()` to rebuild the list based on permissions.
- Quickly check if a certain player will receive your message with `isRecipient()`.

---

## Improved: `EntityDamageEvent`

**Namespace:** `pocketmine\event\entity\EntityDamageEvent`

New methods:

- Modifiers:
  - `getTotalModifier() : float`
  - `hasModifiers() : bool`
- Type checks:
  - `isFallDamage() : bool`
  - `isFireDamage() : bool`
  - `isExplosionDamage() : bool`
  - `isProjectileDamage() : bool`
  - `isVoidDamage() : bool`
  - `isSuffocationDamage() : bool`
  - `isStarvationDamage() : bool`
  - `isSuicide() : bool`
  - `isCustomDamage() : bool`
  - `isEnvironmentalDamage() : bool`
- Lethality:
  - `willKillEntity() : bool`

**Examples:**

- Clear environmental fire damage only:
  - use `isFireDamage()` together with `isEnvironmentalDamage()`.
- Check if a shot will be lethal:
  - use `willKillEntity()` to log or trigger kill-streaks, animations, etc.

---

## Improved: `EntityDamageByEntityEvent`

**Namespace:** `pocketmine\event\entity\EntityDamageByEntityEvent`

New methods:

- `getDamagerEntityId() : int`
- `isDamagerLiving() : bool`
- `isDamagerPlayer() : bool`
- `getDamagerLiving() : ?Living`
- `getDamagerPlayer() : ?Player`

**Examples:**

- Allow PVP only:
  - check `isDamagerPlayer()` and that the victim is a `Player`.
-Recover the attacking `Player` directly:
  - use `getDamagerPlayer()` without doing manual casts.

---

## Improved: `PlayerInteractEvent`

**Namespace:** `pocketmine\event\player\PlayerInteractEvent`

New methods:

- Click type:
  - `isLeftClick() : bool`
  - `isRightClick() : bool`
- Block:
  - `getBlockPosition() : Position`
- Usage flags:
  - `isItemUseAllowed() : bool` (alias di `useItem()`)
  - `isBlockUseAllowed() : bool` (alias di `useBlock()`)
  - `isItemOnlyInteraction() : bool`
  - `isBlockOnlyInteraction() : bool`

**Examples:**

- Handle right-click only on blocks:
  - use `isRightClick()` and `getBlockPosition()`.
- Rilevare quando è disabilitata solo l’interazione item:
  - use `isBlockOnlyInteraction()` (useful for spawn eggs, buckets, etc.).
---

## Improved: `PlayerDeathEvent`

**Namespace:** `pocketmine\event\player\PlayerDeathEvent`

New methods:

- Cause / killer:
  - `getDamageCause() : ?EntityDamageEvent`
  - `wasKilledByEntity() : bool`
  - `wasKilledByPlayer() : bool`
  - `wasKilledByEnvironment() : bool`
- Drops:
  - `getDropCount() : int`
  - `hasDrops() : bool`
  - `clearDrops() : void`
  - `addDrop(Item $item) : void`
  - `addDrops(array $items) : void`
  - `removeDropAt(int $index) : void`
- XP:
  - `hasXpDrop() : bool`
  - `clearXpDrop() : void`

**Examples:**

-Minigame: No Arena Drops/XP:
  - use `clearDrops()`, `clearXpDrop()`, `setKeepInventory(true)`, `setKeepXp(true)`.
- PVP Stats:
  - Use `wasKilledByPlayer()` and `getDamageCause()` to identify killer and damage type.

---

## Improved: `PlayerRespawnEvent`

**Namespace:** `pocketmine\event\player\PlayerRespawnEvent`

New methods:

- `getRespawnWorld() : World`
- `getRespawnX() : int`
- `getRespawnY() : int`
- `getRespawnZ() : int`
- `isRespawnInDefaultWorld() : bool`
- `isRespawnInCustomWorld() : bool`

**Examples:**

- Report respawn in custom world:
  - use `isRespawnInCustomWorld()` and send a message to the player.
- Logging respawn coordinates:
  - use `getRespawnWorld()` and the `getRespawnX/Y/Z()` methods.

---

## Improved: `BlockBreakEvent`

**Namespace:** `pocketmine\event\block\BlockBreakEvent`

New methods:

- Insta-break:
  - `isInstaBreak() : bool` (alias di `getInstaBreak()`)
- Drops:
  - `getDropCount() : int`
  - `hasDrops() : bool`
  - `clearDrops() : void`
  - `addDrop(Item $item) : void`
  - `addDrops(array $items) : void`
  - `removeDropAt(int $index) : void`
- XP:
  - `hasXpDrop() : bool`
  - `clearXpDrop() : void`

**Examples:**

- Remove drops and XP in protected regions:
  -use `clearDrops()` and `clearXpDrop()` to cancel rewards.
- Add custom drops:
  - use `addDrop()` and `addDrops()` to insert new items into the drop.

---

## Improved: `BlockPlaceEvent`

**Namespace:** `pocketmine\event\block\BlockPlaceEvent`

New methods:

- World / count:
  - `getWorld() : World`
  - `getBlockChangeCount() : int`
  - `isMultiBlockPlacement() : bool`
- Primary block:
  - `getPrimaryBlock() : ?Block`
  - `getPrimaryBlockPosition() : ?Position`
- All changed blocks:
  - `getChangedBlockPositions() : array` (lista di `Position`)

**Examples:**

- Prohibit multi-block placements in certain worlds (e.g. lobbies):
  - use `isMultiBlockPlacement()` and `getWorld()->getFolderName()`.
- Check all positions involved:
  - use `getChangedBlockPositions()` to validate/filter positions before placement.
---

## Changed

### Chunk Queue Hook

- The internal method `ChunkSendQueue::queueChunk()` now:
  - emits `PlayerChunkQueuedSendEvent` when a chunk is queued,
  - respect:
    - cancellation (avoid queuing),
    - change priority (use new value).

Nessun altro comportamento cambia, a meno che un plugin non intercetti questo evento.

---

## Compatibility

- No public methods have been removed or renamed.
- All modifications are **additive** and backwards compatible.
- Plugins written for PocketMine‑MP 5 will continue to function normally.
- Plugins can take advantage of CloudPM features:
  - using the new helpers on `Player` and events,
  - handling `PlayerChunkQueuedSendEvent` for finer control over chunk sending.

---
